import{u as L,r as n,h as f,n as _,j as a,C as z,i as B,X as w}from"./app-4d58a1c1.js";import{S as y}from"./SafeHtmlParser-3deb5c6b.js";import{S}from"./star-2e2e9a2f.js";import{C as K}from"./chevron-left-797d531f.js";const G=()=>{const{user:x,updateUserData:C}=L(),[j,g]=n.useState([]),[P,N]=n.useState(!1),[o,b]=n.useState(!1),[i,u]=n.useState(1),[e,p]=n.useState(null),h=32;n.useEffect(()=>{I()},[]);const I=async()=>{try{N(!0);const s=await f.get("/shop/accumulate-items");if(s.data.success){const t=s.data.data.reduce((r,c)=>[...r,...c.products],[]);g(t)}}catch(s){console.error("Error fetching accumulate items:",s),_.error("Không thể tải danh sách vật phẩm")}finally{N(!1)}},k=async s=>{var t,r;if(!o)try{b(!0);const c=await f.post("/shop/buy-accumulate",{product_id:s.id});c.data.success&&(_.success("Mua vật phẩm thành công!"),C({accumulate:c.data.data.remaining_accumulate,coin:c.data.data.remaining_coin}),p(null),g(m=>m.map(d=>d.id===s.id?{...d,đã_mua:!0}:d)))}catch(c){const m=((r=(t=c.response)==null?void 0:t.data)==null?void 0:r.message)||"Có lỗi xảy ra khi mua vật phẩm";_.error(m)}finally{b(!1)}},M=()=>{if(!e)return null;const s=x.accumulate>=e.accumulate_price;return B.createPortal(a.jsx("div",{className:"ashop-popup",children:a.jsxs("div",{className:"ashop-popup__container",children:[a.jsx("button",{onClick:()=>p(null),className:"ashop-popup__close",children:a.jsx(w,{size:24})}),a.jsxs("div",{className:"ashop-popup__content",children:[a.jsx("div",{className:"ashop-popup__image-wrapper",children:a.jsx("img",{src:e.image,alt:e.name,className:"ashop-popup__image"})}),a.jsx("h3",{className:"ashop-popup__title",children:e.name}),a.jsx("div",{className:"ashop-popup__description",children:a.jsx(y,{html:e.description||"Không có mô tả."})}),e.content&&a.jsxs("div",{className:"ashop-popup__details",children:[a.jsx("h4",{className:"ashop-popup__subtitle",children:"Chi tiết sản phẩm"}),a.jsx(y,{html:e.content})]}),a.jsxs("div",{className:"ashop-popup__price-info",children:[a.jsxs("div",{className:"ashop-popup__price",children:[a.jsxs("div",{className:"ashop-popup__price-header",children:[a.jsx(S,{className:"ashop-popup__price-icon"}),a.jsx("span",{className:"ashop-popup__price-label",children:"Giá:"})]}),a.jsxs("span",{className:"ashop-popup__price-value",children:[e.accumulate_price.toLocaleString()," Điểm"]})]}),a.jsxs("div",{className:"ashop-popup__balance",children:[a.jsx("span",{className:"ashop-popup__balance-label",children:"Điểm tích lũy của bạn:"}),a.jsxs("span",{className:"ashop-popup__balance-value",children:[x.accumulate.toLocaleString()," Điểm"]})]})]}),a.jsx("button",{onClick:()=>k(e),disabled:o||!s,className:`ashop-popup__buy-button ${o||!s?"ashop-popup__buy-button--disabled":""}`,children:o?"Đang xử lý...":s?"Mua ngay":"Không đủ điểm tích lũy"})]})]})}),document.getElementById("popup-root"))},l=Math.ceil(j.length/h),v=(i-1)*h,A=v+h,E=j.slice(v,A);return a.jsxs("div",{className:"ashop-container",children:[P?a.jsx("div",{className:"ashop-loading",children:a.jsx("div",{className:"ashop-loading__spinner"})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"ashop-grid",children:E.map(s=>a.jsxs("div",{onClick:()=>p(s),className:"ashop-item",children:[a.jsx("div",{className:"ashop-item__image-container",children:a.jsx("img",{src:s.image,alt:s.name,className:"ashop-item__image",loading:"lazy"})}),a.jsxs("div",{className:"ashop-item__content",children:[a.jsx("h3",{className:"ashop-item__title",children:s.name}),a.jsxs("div",{className:"ashop-item__price",children:[a.jsx(S,{className:"ashop-item__price-icon"}),a.jsx("span",{className:"ashop-item__price-value",children:s.accumulate_price.toLocaleString()})]}),a.jsx("button",{onClick:t=>{t.stopPropagation(),p(s)},className:"ashop-item__buy-button",children:"Mua ngay"})]})]},s.id))}),l>1&&a.jsxs("div",{className:"ashop-pagination",children:[a.jsx("button",{onClick:()=>u(s=>Math.max(s-1,1)),disabled:i===1,className:"ashop-pagination__button",children:a.jsx(K,{size:20})}),Array.from({length:l},(s,t)=>t+1).map(s=>a.jsx("button",{onClick:()=>u(s),className:`ashop-pagination__number ${i===s?"ashop-pagination__number--active":""}`,children:s},s)),a.jsx("button",{onClick:()=>u(s=>Math.min(s+1,l)),disabled:i===l,className:"ashop-pagination__button",children:a.jsx(z,{size:20})})]})]}),M()]})};export{G as default};
