import{r as n,u as P,w as X,n as $,j as t,R as D,C as E}from"./app-4d58a1c1.js";import{H as F}from"./UserProfile-d5652f76.js";import{S as V}from"./search-707095e5.js";import{C as G}from"./chevron-left-797d531f.js";import"./crown-80023408.js";import"./coins-89cc77ad.js";import"./credit-card-11b7fc7f.js";import"./gift-a60ca994.js";const U=()=>{const[S,w]=n.useState([]),[L,f]=n.useState(!0),[b,y]=n.useState(null);P();const[l,u]=n.useState(1),[x]=n.useState(10),[g,k]=n.useState(""),[o,v]=n.useState({startDate:"",endDate:""}),[j,H]=n.useState("all"),C={1:{label:"Nạp Xu",color:"green",sign:"+",unit:"Xu"},2:{label:"Mua Vật Phẩm",color:"red",sign:"-",unit:"Xu"},3:{label:"Admin Nạp",color:"blue",sign:"+",unit:"Xu"},4:{label:"Mua Bằng Điểm Tích Lũy",color:"purple",sign:"-",unit:"Điểm"}};n.useEffect(()=>{p()},[]);const p=async()=>{try{f(!0);const e=await X();w(e.data),y(null)}catch(e){console.error("Lỗi khi lấy lịch sử giao dịch:",e),y("Không thể tải lịch sử giao dịch"),$.error("Có lỗi xảy ra khi tải lịch sử giao dịch")}finally{f(!1)}},M=e=>new Date(e).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),A=e=>new Intl.NumberFormat("vi-VN").format(e),R=()=>S.filter(e=>{var c,a;const s=((c=e.productName)==null?void 0:c.toLowerCase().includes(g.toLowerCase()))||((a=e.transactionCode)==null?void 0:a.toLowerCase().includes(g.toLowerCase())),r=j==="all"||e.type.toString()===j,i=new Date(e.date),d=(!o.startDate||i>=new Date(o.startDate))&&(!o.endDate||i<=new Date(o.endDate));return s&&r&&d}),I=(e,s)=>{const i=[],d=[];let c;if(i.push(1),s<=1)return i;for(let a=e-2;a<=e+2;a++)a<s&&a>1&&i.push(a);i.push(s);for(let a of i)c&&(a-c===2?d.push(c+1):a-c!==1&&d.push("...")),d.push(a),c=a;return d},m=R(),h=Math.ceil(m.length/x),N=l*x,_=N-x,T=m.slice(_,N);return L?t.jsx("div",{className:"th-container",children:t.jsxs("div",{className:"th-loading",children:[t.jsx("div",{className:"th-loading__header"}),[...Array(5)].map((e,s)=>t.jsx("div",{className:"th-loading__row"},s))]})}):b?t.jsx("div",{className:"th-container",children:t.jsxs("div",{className:"th-error",children:[t.jsx("p",{className:"th-error__message",children:b}),t.jsxs("button",{onClick:p,className:"th-error__button",children:[t.jsx(D,{className:"th-error__icon"}),"Thử lại"]})]})}):t.jsxs("div",{className:"th-container",children:[t.jsx("div",{className:"th-header",children:t.jsxs("h4",{className:"th-title",children:[t.jsx(F,{className:"th-title__icon"}),"Lịch Sử Giao Dịch"]})}),t.jsxs("div",{className:"th-filters",children:[t.jsxs("div",{className:"th-search",children:[t.jsx(V,{className:"th-search__icon"}),t.jsx("input",{type:"text",placeholder:"Tìm kiếm...",className:"th-search__input",value:g,onChange:e=>k(e.target.value)})]}),t.jsxs("div",{className:"th-date-range",children:[t.jsx("input",{type:"date",className:"th-date-range__input",value:o.startDate,onChange:e=>v(s=>({...s,startDate:e.target.value}))}),t.jsx("input",{type:"date",className:"th-date-range__input",value:o.endDate,onChange:e=>v(s=>({...s,endDate:e.target.value}))})]}),t.jsxs("select",{className:"th-type-filter",value:j,onChange:e=>H(e.target.value),children:[t.jsx("option",{value:"all",children:"Tất cả giao dịch"}),Object.entries(C).map(([e,{label:s}])=>t.jsx("option",{value:e,children:s},e))]}),t.jsxs("button",{onClick:p,className:"th-refresh",children:[t.jsx(D,{className:"th-refresh__icon"}),"Làm mới"]})]}),t.jsx("div",{className:"th-table-container",children:t.jsxs("table",{className:"th-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"STT"}),t.jsx("th",{children:"Tên Vật Phẩm"}),t.jsx("th",{children:"Số Lượng"}),t.jsx("th",{children:"Xu"}),t.jsx("th",{children:"Mã Giao Dịch"}),t.jsx("th",{children:"Số Điện Thoại"}),t.jsx("th",{children:"Hình Thức"}),t.jsx("th",{children:"Ngày Giao Dịch"})]})}),t.jsx("tbody",{children:T.length>0?T.map((e,s)=>{const r=C[e.type];return t.jsxs("tr",{className:"th-table__row",children:[t.jsx("td",{children:_+s+1}),t.jsx("td",{children:e.productName||"N/A"}),t.jsx("td",{className:"text-center",children:e.qty||1}),t.jsxs("td",{className:`th-amount th-amount--${r.color}`,children:[r.sign," ",A(e.coin)," ",r.unit]}),t.jsx("td",{children:e.transactionCode||"N/A"}),t.jsx("td",{children:e.phone||"N/A"}),t.jsx("td",{children:t.jsx("span",{className:`th-badge th-badge--${r.color}`,children:r.label})}),t.jsx("td",{children:M(e.date)})]},s)}):t.jsx("tr",{children:t.jsx("td",{colSpan:"8",className:"th-empty",children:"Không có dữ liệu lịch sử giao dịch."})})})]})}),h>1&&t.jsxs("div",{className:"th-pagination",children:[t.jsxs("div",{className:"th-pagination__info",children:["Hiển thị ",_+1," - ",Math.min(N,m.length)," trong số ",m.length," giao dịch"]}),t.jsxs("div",{className:"th-pagination__controls",children:[t.jsx("button",{onClick:()=>u(1),disabled:l===1,className:"th-pagination__arrow",title:"Trang đầu",children:"⟪"}),t.jsx("button",{onClick:()=>u(e=>Math.max(e-1,1)),disabled:l===1,className:"th-pagination__arrow",children:t.jsx(G,{})}),I(l,h).map((e,s)=>t.jsx("button",{onClick:()=>typeof e=="number"&&u(e),className:`th-pagination__button ${l===e?"th-pagination__button--active":""} ${typeof e!="number"?"th-pagination__dots":""}`,disabled:typeof e!="number",children:e},s)),t.jsx("button",{onClick:()=>u(e=>Math.min(e+1,h)),disabled:l===h,className:"th-pagination__arrow",children:t.jsx(E,{})}),t.jsx("button",{onClick:()=>u(h),disabled:l===h,className:"th-pagination__arrow",title:"Trang cuối",children:"⟫"})]})]})]})};export{U as default};
