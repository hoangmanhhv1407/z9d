import{c as O,r as t,u as T,i as K,h as x,j as s,C as U,k as V,X as J,l as W}from"./app-510cf451.js";import{S as q}from"./SafeHtmlParser-63da69f7.js";import{C as A}from"./coins-5a2b9d22.js";import{C as Y}from"./chevron-left-665ed8fc.js";import{C as Z}from"./clock-6dd9c6de.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=O("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const os=({activeTab:j,setActiveTab:b})=>{var E;const[l,y]=t.useState([]),[$,S]=t.useState(!1),[m,k]=t.useState(!1),[d,p]=t.useState(1),[a,h]=t.useState(null),[o,M]=t.useState(1),[g,w]=t.useState(null),N=32,{user:v,updateUserData:B}=T();t.useEffect(()=>{R()},[]),t.useEffect(()=>{if(l.length>0&&!g){const e=l[0].name;w(e),b(e)}},[l]),t.useEffect(()=>{p(1)},[j]);const R=async()=>{try{S(!0);const e=await K.get("/shop/items");e.data.success&&y(e.data.data)}catch(e){console.error("Error fetching shop items:",e),x.error("Không thể tải danh sách vật phẩm")}finally{S(!1)}},H=async(e,n)=>{var _,r;if(m)return;const c=e.price*n;if(v.coin<c){x.error("Không đủ xu để mua vật phẩm này");return}try{k(!0);const i=await K.post("/shop/buy",{product_id:e.id,quantity:n});i.data.success&&(x.success("Mua vật phẩm thành công!"),B({coin:i.data.data.remaining_coin,accumulate:i.data.data.accumulate,tongtieucoin:i.data.data.tongtieucoin}),y(f=>f.map(z=>({...z,products:z.products.map(C=>C.id===e.id?{...C,remaining_turns:i.data.data.remaining_turns}:C)}))),h(null))}catch(i){const f=((r=(_=i.response)==null?void 0:_.data)==null?void 0:r.message)||"Có lỗi xảy ra khi mua vật phẩm";x.error(f)}finally{k(!1)}},Q=e=>{w(e),b(e),p(1)},X=e=>{if(!e)return"";const n={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("vi-VN",n)},I=e=>{if(!e)return!1;const n=new Date(e);return(new Date-n)/(1e3*60*60*24)<=7},P=((E=l.find(e=>e.name===(g||j)))==null?void 0:E.products)||[],u=Math.ceil(P.length/N),D=(d-1)*N,F=D+N,L=P.slice(D,F),G=()=>{if(!a)return null;const e=a.limit?a.remaining_turns:99,n=a.price*o,c=v.coin>=n,_=I(a.created_at);return V.createPortal(s.jsx("div",{className:"mshop-popup",children:s.jsxs("div",{className:"mshop-popup__container",children:[s.jsx("button",{className:"mshop-popup__close",onClick:()=>h(null),children:s.jsx(J,{size:24})}),s.jsxs("div",{className:"mshop-popup__content",children:[s.jsxs("div",{className:"mshop-popup__image-container",children:[s.jsx("img",{src:a.image,alt:a.name,className:"mshop-popup__image"}),_&&s.jsx("div",{className:"mshop-popup__new-badge",children:"MỚI"})]}),s.jsx("h3",{className:"mshop-popup__title",children:a.name}),a.created_at&&s.jsxs("div",{className:"mshop-popup__date",children:[s.jsx(Z,{size:16}),s.jsxs("span",{children:["Ngày thêm: ",X(a.created_at)]})]}),a.limit>0&&s.jsxs("div",{className:"mshop-popup__limit",children:[s.jsxs("div",{className:"mshop-popup__limit-row",children:[s.jsx("span",{children:"Giới hạn mua:"}),s.jsxs("span",{children:[a.limit," lượt/tuần"]})]}),s.jsxs("div",{className:"mshop-popup__limit-row",children:[s.jsx("span",{children:"Còn lại:"}),s.jsxs("span",{children:[a.remaining_turns," lượt"]})]})]}),s.jsx("div",{className:"mshop-popup__description",children:s.jsxs("div",{className:"mshop-popup__section",children:[s.jsx("h4",{children:"Mô tả sản phẩm"}),s.jsx(q,{html:a.description||"Không có mô tả."})]})}),a.content&&s.jsx("div",{className:"mshop-popup__details",children:s.jsxs("div",{className:"mshop-popup__section",children:[s.jsx("h4",{children:"Chi tiết sản phẩm"}),s.jsx(q,{html:a.content})]})}),s.jsxs("div",{className:"mshop-popup__price",children:[s.jsx(A,{className:"mshop-popup__price-icon"}),s.jsxs("span",{children:[a.price.toLocaleString()," xu"]})]}),s.jsxs("div",{className:"mshop-popup__quantity",children:[s.jsx("label",{children:"Số lượng:"}),s.jsxs("div",{className:"mshop-popup__quantity-controls",children:[s.jsx("button",{onClick:()=>M(r=>Math.max(1,r-1)),disabled:o<=1,children:"-"}),s.jsx("span",{children:o}),s.jsx("button",{onClick:()=>M(r=>Math.min(e,r+1)),disabled:o>=e,children:"+"})]})]}),s.jsxs("div",{className:"mshop-popup__total",children:[s.jsxs("div",{className:"mshop-popup__total-row",children:[s.jsx("span",{children:"Tổng tiền:"}),s.jsxs("span",{children:[n.toLocaleString()," xu"]})]}),!c&&s.jsxs("div",{className:"mshop-popup__error",children:[s.jsx(W,{size:16}),"Không đủ xu (thiếu ",(n-v.coin).toLocaleString()," xu)"]})]}),s.jsx("button",{onClick:()=>H(a,o),disabled:m||!c||o>e,className:`mshop-popup__buy-button ${m||!c?"mshop-popup__buy-button--disabled":""}`,children:m?s.jsxs("div",{className:"mshop-popup__loading",children:[s.jsx("div",{className:"mshop-popup__spinner"}),"Đang xử lý..."]}):"Xác nhận mua"})]})]})}),document.getElementById("popup-root"))};return s.jsxs("div",{className:"mshop-container",children:[s.jsxs("aside",{className:"mshop-sidebar",children:[s.jsx("h2",{className:"mshop-sidebar__title",children:"Kỳ Trân Các"}),s.jsx("ul",{className:"mshop-sidebar__list",children:l.map(e=>s.jsxs("li",{onClick:()=>Q(e.name),className:`mshop-sidebar__item ${(g||j)===e.name?"mshop-sidebar__item--active":""}`,children:[s.jsx(ss,{className:"mshop-sidebar__icon"}),e.name]},e.id))})]}),s.jsx("div",{className:"mshop-content",children:$?s.jsxs("div",{className:"mshop-loading",children:[s.jsx("div",{className:"mshop-loading__spinner"}),s.jsx("span",{className:"mshop-loading__text",children:"Đang tải..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mshop-grid",children:L.length===0?s.jsx("div",{className:"mshop-empty",children:"Không có sản phẩm nào trong danh mục này"}):L.map(e=>s.jsxs("div",{onClick:()=>h(e),className:"mshop-item",children:[s.jsxs("div",{className:"mshop-item__image-container",children:[s.jsx("img",{src:e.image,alt:e.name,className:"mshop-item__image"}),I(e.created_at)&&s.jsx("div",{className:"mshop-item__new-badge",children:"MỚI"})]}),e.limit>0&&s.jsxs("div",{className:"mshop-item__limit",children:["Còn ",e.remaining_turns,"/",e.limit]}),s.jsxs("div",{className:"mshop-item__info",children:[s.jsx("h3",{className:"mshop-item__name",children:e.name}),s.jsxs("div",{className:"mshop-item__price",children:[s.jsx(A,{className:"mshop-item__price-icon"}),s.jsx("span",{children:e.price.toLocaleString()})]}),s.jsx("button",{onClick:n=>{n.stopPropagation(),h(e)},className:"mshop-item__buy-button",children:"Mua ngay"})]})]},e.id))}),u>1&&s.jsxs("div",{className:"mshop-pagination",children:[s.jsx("button",{onClick:()=>p(e=>Math.max(e-1,1)),disabled:d===1,className:"mshop-pagination__button",children:s.jsx(Y,{size:20})}),Array.from({length:u},(e,n)=>n+1).map(e=>s.jsx("button",{onClick:()=>p(e),className:`mshop-pagination__number ${d===e?"mshop-pagination__number--active":""}`,children:e},e)),s.jsx("button",{onClick:()=>p(e=>Math.min(e+1,u)),disabled:d===u,className:"mshop-pagination__button",children:s.jsx(U,{size:20})})]})]})}),G()]})};export{os as default};
