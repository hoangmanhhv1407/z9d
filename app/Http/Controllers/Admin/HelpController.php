<?php namespace App\Http\Controllers\Admin;use App\Http\Requests\HelpRequest;use App\Models\CategoryHelp;use App\Models\Help;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use DB;use Carbon\Carbon;class HelpController extends Controller{public function index(Request $request){$showBlog=Help::where('h_name','like','%'.$request->name.'%')->where('h_category_id','like','%'.$request->category_help.'%')->with(['categoryHelp'=>function($query){$query->where('ch_active',1);}])->paginate(10);$category=CategoryHelp::where('ch_active',1)->get();$dataView=['showBlog'=>$showBlog,'category'=>$category,'query'=>$request->query()];return view('admin.help.index',$dataView);}public function add(){$category=CategoryHelp::where('ch_active',1)->get();return view('admin.help.add',compact('category'));}public function store(HelpRequest $request){$data=$request->all();if($request->hasFile('h_thunbar')){$info=uploadImg('h_thunbar');if($info['code']==1){$data['h_thunbar']=$info['name'];move_uploaded_file($_FILES['h_thunbar']['tmp_name'],public_path().'/uploads/imgHelp/'.$info['name']);}}$data['h_slug']=str_slug($request->h_name);$data['created_at']=$data['updated_at']=Carbon::now();unset($data['_token']);$id=Help::insert($data);if($id>0){return redirect()->route('admin.help.index')->with('success',' The update was successful !!! ');}return redirect()->route('admin.help.index')->with('danger',' The update was failed !!! ');}public function edit(Request $request,$id){$category=CategoryHelp::where('ch_active',1)->get();$blog=Help::findOrFail($id);return view('admin.help.edit',compact('blog','category'));}public function update(Request $request,$id){$data=$request->all();unset($data['_token']);if($request->hasFile('h_thunbar')){$info=uploadImg('h_thunbar');if($info['code']==1){$data['h_thunbar']=$info['name'];move_uploaded_file($_FILES['h_thunbar']['tmp_name'],public_path().'/uploads/imgHelp/'.$info['name']);}}else{$data['h_thunbar']=Help::findOrFail($id)->h_thunbar;}$data['h_slug']=str_slug($request->h_name);$data['updated_at']=Carbon::now();$id=Help::where('id',$id)->update($data);if($id>0){return redirect()->route('admin.help.index')->with('success',' The update was successful !!! ');}return redirect()->route('admin.help.index')->with('danger',' The update was failed !!! ');}public function delete($id){$blog=Help::findOrFail($id);$flagCheck=$blog->delete();if($flagCheck>0){return redirect()->back()->with('success',' The update was successful !!! ');}return redirect()->back()->with('danger',' The update was failed !!! ');}public function status($id,$status){if($status==1){Help::where('id',$id)->update(['h_status'=>0]);return redirect()->back()->with('success',' The update was successful !!! ');}elseif($status==0){Help::where('id',$id)->update(['h_status'=>1]);return redirect()->back()->with('success',' The update was successful !!! ');}return redirect()->back()->with('danger','  The update was failed !!! ');}}